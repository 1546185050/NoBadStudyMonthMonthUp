# 《重构改善既有代码的设计》3月读书笔记



## 章节一、重构，第一个案例

第一章是由一个生活的实例讲起，

是一个影片出租店用的程序，计算每一位顾客的消费金额并打印报表（statement）。

打印报表（statement）又包含了【统计消费金额】和【计算顾客的积分规则】两个功能函数，

通过第一章的学习，我学会了怎样分解重组函数，怎么用多态去取代条件复杂的相关逻辑（价格）。

每当我们要进行重构的时候，第一个步骤永远相同：我们得为即将修改的代码建立一组可靠的测试环境。因为当你

修改程序时，好测试会给你必要的安全保障。



## 章节二、重构原则

### 2.1  何为重构

重构 ：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下改善其内部结构，提高其可理解

性、降低其修改成本。



### 2.2  为何重构

代码结构的流失是累积性的。愈难看出代码所代表的设计意涵，就愈难保护其中设计，于是该设计就腐败得愈快。

经常性的重构可以帮助代码维持自己该有的形态。

重构可以改进软件设计，其中一个重要的方向就是消除重复代码。使软件更容易的被理解。



思考：**除了计算机外，我们的源码还有其他读者：数个月之后可能会有另一位程序员尝试读懂我们的代码并做一些修改。很多时候那个「未来的开发者」就是我自己。此时重构就显得尤其重要了。**



### 2.3  何时重构

事不过三，三则重构。第三次做同样的事、遇到同样的麻烦，就是需要重构的时候了。

我们可以在添加功能、修补错误、复审代码时候重构代码。



思考：**添加功能时重构既是弥补的一次机会，同时同样的时间消耗却多了额外的产出：更容易维护的设计。**



### 2.4  重构与性能

- 重构是有可能导致程序运行变慢的；
- 除了对实时有严格要求的程序，编写快速软件的秘诀是：**首先写出可调的程序，然后调整它以达到足够的速度**；
- 性能优化放在开发的后期，通过分析工具找出消耗大量时间空间的地方，然后集中精力优化这些地方；

