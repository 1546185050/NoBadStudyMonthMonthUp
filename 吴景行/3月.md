### 1 上线情况
已经集成在9.0版本中。通过bugly观察，有两款机型出现了写入日志时出现崩溃。跟踪得知，为腾讯提供的mmkv，在写入时出现了memcpy字节对齐错误（按理，一个已经在微信上线5年的框架，不应该出现这样的错误）。

解决：

把mmkv框架更新到最新版本，该版本在changelog中有提及，“Fix a potential crash when writing a uniquely constructed string”，后继版本继续观察

后备方案

1.使用Android原生的API，NIO--MappedByteBuffer，其原理都是通过把文件映射到内存进行操作

2.使用传统的SQLite存储

### 2 为什么考虑mmkv

mmkv在埋点中扮演临时缓存的角色，技术选型时基于以下考虑

1.埋点可发生在各个业务行为中，若是在主线程，大量的IO操作，易造成界面卡顿

2.埋点信息无论是缓存一定数量再提交或是马上提交，都需要保证埋点信息不会因为突然崩溃、杀app而丢失

而 mmkv的核心在于通过mmap内存映射文件，提供一段可供随时写入的内存块，App只管往里面写数据，由操作系统负责将内存回写到文件，不必担心crash导致数据丢失。同时，mmap跳过了传统的IO操作时，用户态和内核态的缓存拷贝，读写效率更高。


### 3 后继

1.实现pc端对埋点信息的汇总整理及展示。目前信息虽都上传到OSS，但对用户行为的分析还是很不方便，而且也缺少信息的过滤和查找，随日志增多，就是茫茫大海捞针。

2.通过插桩等方式，实现对UI的无入侵埋点。